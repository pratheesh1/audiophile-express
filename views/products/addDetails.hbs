{{#extends 'base'}}

{{#block 'css'}}
{{!-- swiper js css --}}
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
<style>
    .mySwiper .swiper-slide {
        opacity: 0.2;
    }

    .mySwiper .swiper-slide-thumb-active {
        opacity: 1;
    }

    div[class^="swipe"] {
        height: 10% !important;
    }

    .swiper.mySwiper2 {
        height: 40% !important;
        margin-bottom: 5px;
    }
</style>
{{/block}}

{{#block 'title'}}
Add Product Details
{{/block}}

{{#block 'content'}}

<div class="bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-white min-h-screen h-auto">
    <div class="md:grid md:grid-cols-12 md:gap-6">
        <div class="md:col-start-2 md:col-span-3 p-3 lg:p-10">
            <div class="px-4 sm:px-0">
                <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Add Product details:</h3>
                <hr class="hidden: md:visible border border-gray-600 mt-3" />
                <p class="mt-1 text-xs text-gray-600 dark:text-white">
                    Fields marked with * are required.
                </p>
                <p class="mt-5 text-sm text-gray-600 dark:text-white">
                    This form allows you to add a more details of the product.
                </p>
            </div>
        </div>
        <div class="md:col-start-5 md:col-end-12 lg:col-end-10 p-3 lg:-10">
            {{!-- image --}}
            <div style="--swiper-navigation-color: #fff; --swiper-pagination-color: #fff" class="swiper mySwiper2">
                <div class="swiper-wrapper" style="height: auto !important;">
                    {{!-- add image here --}}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
            <div thumbsSlider="" class="swiper mySwiper" style="height: '20px' !important;">
                <div class="swiper-wrapper">
                    {{!-- add image here --}}
                </div>
            </div>
            {{!-- end image --}}

            <div>
                <form action="/products/add" method="post">
                    <input type="hidden" name="_csrf" value="{{csrfToken}}" />
                    <input type="hidden" id='imageUrl' name="imageUrl" value="" />
                    <input type="hidden" id="imageThumbnailUrl" name="imageThumbnailUrl" value="" />
                    {{!-- add product details up form --}}

                    {{!-- button to upload image --}}
                    <div class="mt-5">
                        <button type="button"
                            class="px-3 py-2 m-3 mt-8 text-sm bg-blue-400 rounded-full text-white hover:text-black hover:bg-blue-200"
                            id="upload-img-btn">Upload Image</button>
                    </div>

                    <div class="flex justify-end">
                        <a href='/products/home'
                            class="m-4 w-1/2 md:w-1/3 lg:w-1/4 bg-blue-500 hover:bg-blue-400 text-white hover:text-black py-2 rounded-full transition duration-100 flex justify-center">Cancel
                        </a>
                        <button
                            class="m-4 w-1/2 md:w-1/3 lg:w-1/4 bg-green-500 hover:bg-green-400 text-white hover:text-black py-2 rounded-full transition duration-100">Update
                            Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{{/block}}

{{#block "scripts"}}
{{! initialize cloudinary js cdn }}
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
{{! axios js cdn }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"
    integrity="sha512-u9akINsQsAkG9xjc1cnGF4zw5TFDwkxuc9vUp5dltDWYCSmyd0meygbvgXrlc/z7/o4a19Fb5V0OUE58J7dcyw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{{!-- Swiper JS --}}
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

{{! custom script }}
<script>
    // initialize cloudinary js
    function generateSignature(callback, params) {
        axios.get('/cloudinary/sign', { params: { params } }).then(function
            (response) { callback(response.data); })
    } var myWidget =
        cloudinary.createUploadWidget({
            cloudName: '{{cloudinaryName}}', apiKey: '{{cloudinaryApiKey}}',
            uploadPreset: '{{cloudinaryPreset}}', uploadSignature: generateSignature
        }, (error, result) => {
            if (!error && result && result.event === "success") {
                //on each successful upload do the following 
                document.querySelectorAll('.swiper-wrapper').forEach(function (el) {
                    el.innerHTML += `<div class="swiper-slide object-cover">
                        <img src="${result.info.url}" />
                    </div>`;
                });
                var imageUrl = document.querySelector('#imageUrl');
                var thumbnailUrl = document.querySelector('#imageThumbnailUrl');
                imageUrl.value = imageUrl.value ? `${imageUrl.value}<new_image>${result.info.url}` : result.info.url;
                thumbnailUrl.value = thumbnailUrl.value ? `${thumbnailUrl.value}<new_image>${result.info.thumbnail_url}` : result.info.thumbnail_url;
            };
        })
    document.getElementById("upload-img-btn").addEventListener("click",
        function () { myWidget.open(); }, false);

    // initialize swiper
    var swiper = new Swiper(".mySwiper", {
        spaceBetween: 10,
        slidesPerView: 4,
        freeMode: true,
        watchSlidesProgress: true,
    });
    var swiper2 = new Swiper(".mySwiper2", {
        spaceBetween: 10,
        navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
        },
        thumbs: {
            swiper: swiper,
        },
    });

</script>
{{/block}}

{{/extends}}